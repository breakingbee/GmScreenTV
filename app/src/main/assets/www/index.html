<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>GmScreen TV Remote</title>
<style>
  body {
    background:#101010;
    color:white;
    margin:0;
    font-family:Arial,Helvetica,sans-serif;
    overflow:hidden;
  }
  h2 {
    text-align:center;
    margin:20px 0 10px;
  }
  .btn {
    margin:6px;
    padding:10px 14px;
    background:#0040ff;
    color:white;
    font-weight:bold;
    border:none;
    border-radius:6px;
    min-width:80px;
    font-size:16px;
  }
  .btn:focus {
    outline:3px solid #ffcc00;
  }
  #list {
    height:60vh;
    overflow-y:auto;
    padding:10px;
    margin:0 auto;
    max-width:900px;
  }
  .item {
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:#222;
    border-radius:6px;
    margin:6px 0;
    padding:10px;
  }
  .name {
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
    max-width:75%;
  }
</style>
</head>
<body>
  <h2>GmScreen TV</h2>
  <div style="text-align:center;">
    <button id="btnAuto" class="btn">Auto-detect STB</button>
    <button id="btnChange" class="btn">Change IP</button>
    <button id="btnFetch" class="btn">Fetch Channels</button>
  </div>
  <div style="text-align:center;margin-top:10px;">Connected to: <span id="ip">â€“</span></div>

  <div id="list"></div>

  <div style="text-align:center;margin-top:10px;">
    <button id="btnDebug" class="btn">Show debug</button>
  </div>

  <div id="debug" style="display:none;white-space:pre-wrap;background:#111;padding:10px;margin:10px;max-height:20vh;overflow:auto;"></div>

<script>
(function(){
  const ipBox=document.getElementById('ip');
  const list=document.getElementById('list');
  const debugBox=document.getElementById('debug');

  function getIp(){try{return NativeBridge.getStbIp();}catch(e){return"";}}
  function setIp(ip){try{NativeBridge.setStbIp(ip);}catch(e){} ipBox.textContent=ip;}

  ipBox.textContent=getIp();

  function renderChannels(arr){
    list.innerHTML='';
    arr.forEach(ch=>{
      const div=document.createElement('div'); div.className='item';
      const name=document.createElement('div'); name.className='name'; name.textContent=`${ch.name} [${ch.id}]`;
      const play=document.createElement('button'); play.className='btn'; play.textContent='Play';
      play.onclick=()=>{try{NativeBridge.openInVlc(ch.url);}catch(e){}};
      play.setAttribute('tabindex','0'); // make D-pad focusable
      div.appendChild(name); div.appendChild(play);
      list.appendChild(div);
    });
  }

  document.getElementById('btnAuto').onclick=()=>{
    try{
      const res=NativeBridge.discoverUdp25860(3000);
      const arr=JSON.parse(res);
      if(arr.length){setIp(arr[0].ip); alert("Found STB: "+arr[0].ip);}
      else alert("No STB found");
    }catch(e){alert("Auto-detect failed");}
  };

  document.getElementById('btnChange').onclick=()=>{
    const cur=getIp(); const ip=prompt("Enter STB IP",cur);
    if(ip){setIp(ip);alert("Saved: "+ip);}
  };

  document.getElementById('btnFetch').onclick=()=>{
    try{
      const json=NativeBridge.fetchChannelsFromStb();
      const arr=JSON.parse(json);
      renderChannels(arr);
      if(arr.length===0) alert("No channels parsed.\nCheck debug.");
    }catch(e){alert("Fetch failed");}
  };

  document.getElementById('btnDebug').onclick=()=>{
    debugBox.style.display='block';
    debugBox.textContent=NativeBridge.getLastDebug();
  };
})();
</script>
</body>
</html>
